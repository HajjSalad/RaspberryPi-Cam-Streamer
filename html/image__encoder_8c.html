<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Real-Time Camera Streaming with Object Detection: src/image/image_encoder.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Real-Time Camera Streaming with Object Detection
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_a6a17ec937b4e07383dde71de6c9d000.html">image</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">image_encoder.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Image format conversion and JPEG compression implementation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;setjmp.h&gt;</code><br />
<code>#include &lt;jpeglib.h&gt;</code><br />
<code>#include &quot;<a class="el" href="image__encoder_8h_source.html">image_encoder.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for image_encoder.c:</div>
<div class="dyncontent">
<div class="center"><img src="image__encoder_8c__incl.png" border="0" usemap="#asrc_2image_2image__encoder_8c" alt=""/></div>
<map name="asrc_2image_2image__encoder_8c" id="asrc_2image_2image__encoder_8c">
<area shape="rect" title="Image format conversion and JPEG compression implementation." alt="" coords="131,5,331,31"/>
<area shape="rect" title=" " alt="" coords="5,79,72,104"/>
<area shape="poly" title=" " alt="" coords="201,33,84,76,82,71,199,28"/>
<area shape="rect" title=" " alt="" coords="97,79,167,104"/>
<area shape="poly" title=" " alt="" coords="216,33,161,73,158,68,213,29"/>
<area shape="rect" title=" " alt="" coords="191,79,270,104"/>
<area shape="poly" title=" " alt="" coords="233,31,233,65,228,65,228,31"/>
<area shape="rect" title=" " alt="" coords="294,79,373,104"/>
<area shape="poly" title=" " alt="" coords="249,28,307,68,304,73,246,33"/>
<area shape="rect" href="image__encoder_8h.html" title="Public API for image format conversion and JPEG compression." alt="" coords="397,79,531,104"/>
<area shape="poly" title=" " alt="" coords="269,28,414,72,413,77,267,33"/>
<area shape="rect" title=" " alt="" coords="427,152,501,177"/>
<area shape="poly" title=" " alt="" coords="467,104,467,138,461,138,461,104"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a916e92ae9237b31e838e362c5e75ab51" id="r_a916e92ae9237b31e838e362c5e75ab51"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="image__encoder_8c.html#a916e92ae9237b31e838e362c5e75ab51">CLIP</a>(x)&#160;&#160;&#160;((x) &lt; 0 ? 0 : ((x) &gt; 255 ? 255 : (x)))</td></tr>
<tr class="memdesc:a916e92ae9237b31e838e362c5e75ab51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensure value stays within 8-bit pixel range: [0, 255] <br  />
  <br /></td></tr>
<tr class="separator:a916e92ae9237b31e838e362c5e75ab51"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a13f1cab5efccf887a855ecfc3b0bd1fb" id="r_a13f1cab5efccf887a855ecfc3b0bd1fb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="image__encoder_8c.html#a13f1cab5efccf887a855ecfc3b0bd1fb">convert_yuyv_to_rgb</a> (const struct <a class="el" href="structyuyv__frame.html">yuyv_frame</a> *yuyv, struct <a class="el" href="structrgb__frame.html">rgb_frame</a> *rgb)</td></tr>
<tr class="memdesc:a13f1cab5efccf887a855ecfc3b0bd1fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert YUYV422 frame to an RGB24 frame.  <br /></td></tr>
<tr class="separator:a13f1cab5efccf887a855ecfc3b0bd1fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6df3039f73153c37e863db634f62579" id="r_af6df3039f73153c37e863db634f62579"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="image__encoder_8c.html#af6df3039f73153c37e863db634f62579">convert_rgb_to_jpeg</a> (const struct <a class="el" href="structrgb__frame.html">rgb_frame</a> *rgb, struct <a class="el" href="structjpeg__frame.html">jpeg_frame</a> *jpeg)</td></tr>
<tr class="memdesc:af6df3039f73153c37e863db634f62579"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode RGB24 frame into JPEG format.  <br /></td></tr>
<tr class="separator:af6df3039f73153c37e863db634f62579"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Image format conversion and JPEG compression implementation. </p>
<p>Provides:</p><ol type="1">
<li>Conversion from YUYV422 to RGB24</li>
<li>JPEG compression of RGB frames using libjpeg</li>
</ol>
<p>These routines are designed to prepare frames for MJPEG HTTP transmission. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a916e92ae9237b31e838e362c5e75ab51" name="a916e92ae9237b31e838e362c5e75ab51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a916e92ae9237b31e838e362c5e75ab51">&#9670;&#160;</a></span>CLIP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CLIP</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;((x) &lt; 0 ? 0 : ((x) &gt; 255 ? 255 : (x)))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Ensure value stays within 8-bit pixel range: [0, 255] <br  />
 </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="af6df3039f73153c37e863db634f62579" name="af6df3039f73153c37e863db634f62579"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6df3039f73153c37e863db634f62579">&#9670;&#160;</a></span>convert_rgb_to_jpeg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int convert_rgb_to_jpeg </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structrgb__frame.html">rgb_frame</a> *&#160;</td>
          <td class="paramname"><em>rgb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structjpeg__frame.html">jpeg_frame</a> *&#160;</td>
          <td class="paramname"><em>jpeg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode RGB24 frame into JPEG format. </p>
<p>Compresses an RGB frame into a JPEG image using th libjpeg library. The resulting JPEG data is written to a memory buffer owned by the <a class="el" href="structjpeg__frame.html" title="Container for a JPEG-compressed image frame.">jpeg_frame</a> structure.</p>
<p>The function initializes and configures the JPEG compressor, writes scanlines sequentially, and finalizes compression before returning.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rgb</td><td>Pointer to the source RGB frame </td></tr>
    <tr><td class="paramname">jpeg</td><td>Pointer to the destination JPEG frame</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure </dd></dl>

</div>
</div>
<a id="a13f1cab5efccf887a855ecfc3b0bd1fb" name="a13f1cab5efccf887a855ecfc3b0bd1fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13f1cab5efccf887a855ecfc3b0bd1fb">&#9670;&#160;</a></span>convert_yuyv_to_rgb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int convert_yuyv_to_rgb </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structyuyv__frame.html">yuyv_frame</a> *&#160;</td>
          <td class="paramname"><em>yuyv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structrgb__frame.html">rgb_frame</a> *&#160;</td>
          <td class="paramname"><em>rgb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert YUYV422 frame to an RGB24 frame. </p>
<p>Converts a raw YUYV422 camera frame into an RGB24 format suitable for JPEG compression and object detection (later extension). The conversion follows the BT.601 color space specification and uses integer arithmetic for performance.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">yuyv</td><td>Pointer to the source YUYV422 frame </td></tr>
    <tr><td class="paramname">rgb</td><td>Pointer to the destination RGB frame</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure </dd></dl>
<p>In each width iteration:</p><ul>
<li>Process 2 pixels</li>
<li>Consumes 4 bytes of YUYV</li>
<li>Produces 6 bytes of RGB (2 pixels x 3 channels)</li>
</ul>
<p>u &amp; v are initially stored as unsigned bytes, range: [0, 255]</p><ul>
<li>u = 128 -&gt; no blue shift (neutral chroma)</li>
<li>v = 128 -&gt; no red shift (neutral chroma) Subtract 128 to recenter chroma values: original: 0 -&gt; 255 Centered: -128 -&gt; +127 (neutral chroma at 0 now) Result: d &amp; e = signed color offsets<ul>
<li>Negative -&gt; reduces color</li>
<li>Positive -&gt; increases color</li>
<li>0 -&gt; no color contribution</li>
</ul>
</li>
</ul>
<p>Pixel 0 Y is initially stored as unsigned byte, range: [0, 255] BT.601 valid luma Range: [16, 235] Y = 16 -&gt; black Y = 235 -&gt; white Subtract 16 to normalize so that black = 0 YUYV -&gt; RGB Conversion equation: -&gt; Floating point is slow, scale by 256 to get integer R = 1.164 * (Y - 16) + 1.596 * (V - 128) -&gt; 298 * (Y - 16) + 409 * (V - 128) G = 1.164 * (Y - 16) - 0.391 * (U - 128) - 0.813 * (V - 128) -&gt; 298 * (Y - 16) - 100 * (U - 128) - 208 * (V - 128) B = 1.164 * (Y - 16) + 2.018 * (U - 128) -&gt; 298 * (Y - 16) + 516 * (U - 128)</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
