<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Real-Time Camera Streaming with Object Detection: src/image/image_encoder.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Real-Time Camera Streaming with Object Detection
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_a6a17ec937b4e07383dde71de6c9d000.html">image</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">image_encoder.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Public API for image format conversion and JPEG compression.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stddef.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for image_encoder.h:</div>
<div class="dyncontent">
<div class="center"><img src="image__encoder_8h__incl.png" border="0" usemap="#asrc_2image_2image__encoder_8h" alt=""/></div>
<map name="asrc_2image_2image__encoder_8h" id="asrc_2image_2image__encoder_8h">
<area shape="rect" title="Public API for image format conversion and JPEG compression." alt="" coords="5,5,207,31"/>
<area shape="rect" title=" " alt="" coords="69,79,143,104"/>
<area shape="poly" title=" " alt="" coords="109,31,109,65,103,65,103,31"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="image__encoder_8h__dep__incl.png" border="0" usemap="#asrc_2image_2image__encoder_8hdep" alt=""/></div>
<map name="asrc_2image_2image__encoder_8hdep" id="asrc_2image_2image__encoder_8hdep">
<area shape="rect" title="Public API for image format conversion and JPEG compression." alt="" coords="475,5,676,31"/>
<area shape="rect" href="camera_8c.html" title="Implementation of the V4L2 camera initialization and teardown routines." alt="" coords="5,79,164,104"/>
<area shape="poly" title=" " alt="" coords="484,35,164,81,163,76,483,30"/>
<area shape="rect" href="circular__buffer_8c.html" title="Circular buffer implementation for storing JPEG frame pointers." alt="" coords="188,79,355,104"/>
<area shape="poly" title=" " alt="" coords="514,36,321,81,320,76,513,31"/>
<area shape="rect" href="mjpeg__stream_8c.html" title="MJPEG frame streaming over HTTP." alt="" coords="379,79,559,104"/>
<area shape="poly" title=" " alt="" coords="548,40,488,81,485,76,546,36"/>
<area shape="rect" href="image__encoder_8c.html" title="Image format conversion and JPEG compression implementation." alt="" coords="583,79,783,104"/>
<area shape="poly" title=" " alt="" coords="605,36,667,76,664,81,603,40"/>
<area shape="rect" href="image__processor_8c.html" title="Image processing stage of the camera streaming pipeline." alt="" coords="807,79,1018,104"/>
<area shape="poly" title=" " alt="" coords="643,31,859,76,857,81,642,36"/>
<area shape="rect" href="main_8c.html" title="Entry point for the Raspberry Pi MJPEG streaming." alt="" coords="1043,79,1132,104"/>
<area shape="poly" title=" " alt="" coords="690,29,851,50,1030,76,1043,78,1042,83,1030,81,851,55,689,35"/>
</map>
</div>
</div>
<p><a href="image__encoder_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structyuyv__frame.html">yuyv_frame</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Container for a raw YUYV422 camera frame.  <a href="structyuyv__frame.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrgb__frame.html">rgb_frame</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Container for an RGB24 image frame.  <a href="structrgb__frame.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structjpeg__frame.html">jpeg_frame</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Container for a JPEG-compressed image frame.  <a href="structjpeg__frame.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acdae86b4a4303e542e0fe769179581d5" id="r_acdae86b4a4303e542e0fe769179581d5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="image__encoder_8h.html#acdae86b4a4303e542e0fe769179581d5">convert_yuyv_to_rgb</a> (const struct <a class="el" href="structyuyv__frame.html">yuyv_frame</a> *in, struct <a class="el" href="structrgb__frame.html">rgb_frame</a> *out)</td></tr>
<tr class="memdesc:acdae86b4a4303e542e0fe769179581d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert YUYV422 frame to an RGB24 frame.  <br /></td></tr>
<tr class="separator:acdae86b4a4303e542e0fe769179581d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19f272db3fe5db9609104a4eb3d61312" id="r_a19f272db3fe5db9609104a4eb3d61312"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="image__encoder_8h.html#a19f272db3fe5db9609104a4eb3d61312">convert_rgb_to_jpeg</a> (const struct <a class="el" href="structrgb__frame.html">rgb_frame</a> *in, struct <a class="el" href="structjpeg__frame.html">jpeg_frame</a> *out)</td></tr>
<tr class="memdesc:a19f272db3fe5db9609104a4eb3d61312"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode RGB24 frame into JPEG format.  <br /></td></tr>
<tr class="separator:a19f272db3fe5db9609104a4eb3d61312"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ef573b65a2219ba975e30ccb655e1c4" id="r_a5ef573b65a2219ba975e30ccb655e1c4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="image__encoder_8h.html#a5ef573b65a2219ba975e30ccb655e1c4">convert_yuyv_to_jpeg</a> (unsigned char *yuyv_data, int width, int height, struct <a class="el" href="structjpeg__frame.html">jpeg_frame</a> *frame)</td></tr>
<tr class="separator:a5ef573b65a2219ba975e30ccb655e1c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Public API for image format conversion and JPEG compression. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a19f272db3fe5db9609104a4eb3d61312" name="a19f272db3fe5db9609104a4eb3d61312"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19f272db3fe5db9609104a4eb3d61312">&#9670;&#160;</a></span>convert_rgb_to_jpeg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int convert_rgb_to_jpeg </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structrgb__frame.html">rgb_frame</a> *&#160;</td>
          <td class="paramname"><em>rgb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structjpeg__frame.html">jpeg_frame</a> *&#160;</td>
          <td class="paramname"><em>jpeg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode RGB24 frame into JPEG format. </p>
<p>Compresses an RGB frame into a JPEG image using th libjpeg library. The resulting JPEG data is written to a memory buffer owned by the <a class="el" href="structjpeg__frame.html" title="Container for a JPEG-compressed image frame.">jpeg_frame</a> structure.</p>
<p>The function initializes and configures the JPEG compressor, writes scanlines sequentially, and finalizes compression before returning.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rgb</td><td>Pointer to the source RGB frame </td></tr>
    <tr><td class="paramname">jpeg</td><td>Pointer to the destination JPEG frame</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure </dd></dl>

</div>
</div>
<a id="a5ef573b65a2219ba975e30ccb655e1c4" name="a5ef573b65a2219ba975e30ccb655e1c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ef573b65a2219ba975e30ccb655e1c4">&#9670;&#160;</a></span>convert_yuyv_to_jpeg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int convert_yuyv_to_jpeg </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>yuyv_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structjpeg__frame.html">jpeg_frame</a> *&#160;</td>
          <td class="paramname"><em>frame</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="acdae86b4a4303e542e0fe769179581d5" name="acdae86b4a4303e542e0fe769179581d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdae86b4a4303e542e0fe769179581d5">&#9670;&#160;</a></span>convert_yuyv_to_rgb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int convert_yuyv_to_rgb </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structyuyv__frame.html">yuyv_frame</a> *&#160;</td>
          <td class="paramname"><em>yuyv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structrgb__frame.html">rgb_frame</a> *&#160;</td>
          <td class="paramname"><em>rgb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert YUYV422 frame to an RGB24 frame. </p>
<p>Function Prototypes</p>
<p>Converts a raw YUYV422 camera frame into an RGB24 format suitable for JPEG compression and object detection (later extension). The conversion follows the BT.601 color space specification and uses integer arithmetic for performance.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">yuyv</td><td>Pointer to the source YUYV422 frame </td></tr>
    <tr><td class="paramname">rgb</td><td>Pointer to the destination RGB frame</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure </dd></dl>
<p>In each width iteration:</p><ul>
<li>Process 2 pixels</li>
<li>Consumes 4 bytes of YUYV</li>
<li>Produces 6 bytes of RGB (2 pixels x 3 channels)</li>
</ul>
<p>u &amp; v are initially stored as unsigned bytes, range: [0, 255]</p><ul>
<li>u = 128 -&gt; no blue shift (neutral chroma)</li>
<li>v = 128 -&gt; no red shift (neutral chroma) Subtract 128 to recenter chroma values: original: 0 -&gt; 255 Centered: -128 -&gt; +127 (neutral chroma at 0 now) Result: d &amp; e = signed color offsets<ul>
<li>Negative -&gt; reduces color</li>
<li>Positive -&gt; increases color</li>
<li>0 -&gt; no color contribution</li>
</ul>
</li>
</ul>
<p>Pixel 0 Y is initially stored as unsigned byte, range: [0, 255] BT.601 valid luma Range: [16, 235] Y = 16 -&gt; black Y = 235 -&gt; white Subtract 16 to normalize so that black = 0 YUYV -&gt; RGB Conversion equation: -&gt; Floating point is slow, scale by 256 to get integer R = 1.164 * (Y - 16) + 1.596 * (V - 128) -&gt; 298 * (Y - 16) + 409 * (V - 128) G = 1.164 * (Y - 16) - 0.391 * (U - 128) - 0.813 * (V - 128) -&gt; 298 * (Y - 16) - 100 * (U - 128) - 208 * (V - 128) B = 1.164 * (Y - 16) + 2.018 * (U - 128) -&gt; 298 * (Y - 16) + 516 * (U - 128)</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
